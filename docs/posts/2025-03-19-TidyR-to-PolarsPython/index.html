<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lance Couzens">
<meta name="dcterms.date" content="2025-03-19">
<meta name="description" content="This post lays out a series of examples that helped me break into Python as a Tidy-style R programmer">

<title>Recreating Some Tidy-Style R Operations with Python and Polars – Lance Couzens</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-8b20df304ae43519df5d458fcc8598a6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Lance Couzens</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Recreating Some Tidy-Style R Operations with Python and Polars</h1>
                  <div>
        <div class="description">
          This post lays out a series of examples that helped me break into Python as a Tidy-style R programmer
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Python</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://mostlyunoriginal.github.io">Lance Couzens</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 19, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#data-manipulation" id="toc-data-manipulation" class="nav-link" data-scroll-target="#data-manipulation">Data Manipulation</a>
  <ul class="collapse">
  <li><a href="#example-1.-basic-summarize-without-generalization-across-variables" id="toc-example-1.-basic-summarize-without-generalization-across-variables" class="nav-link" data-scroll-target="#example-1.-basic-summarize-without-generalization-across-variables">Example 1. Basic Summarize without Generalization across Variables</a>
  <ul class="collapse">
  <li><a href="#r-version" id="toc-r-version" class="nav-link" data-scroll-target="#r-version">R Version</a></li>
  <li><a href="#python-version" id="toc-python-version" class="nav-link" data-scroll-target="#python-version">Python Version</a></li>
  </ul></li>
  <li><a href="#example-2.-basic-mutate-with-grouping-and-without-generalization" id="toc-example-2.-basic-mutate-with-grouping-and-without-generalization" class="nav-link" data-scroll-target="#example-2.-basic-mutate-with-grouping-and-without-generalization">Example 2. Basic Mutate with Grouping and without Generalization</a>
  <ul class="collapse">
  <li><a href="#r-version-1" id="toc-r-version-1" class="nav-link" data-scroll-target="#r-version-1">R Version</a></li>
  <li><a href="#python-version-1" id="toc-python-version-1" class="nav-link" data-scroll-target="#python-version-1">Python Version</a></li>
  </ul></li>
  <li><a href="#example-3.-summarize-generalized-by-variable-type-with-across" id="toc-example-3.-summarize-generalized-by-variable-type-with-across" class="nav-link" data-scroll-target="#example-3.-summarize-generalized-by-variable-type-with-across">Example 3. Summarize Generalized by Variable Type with Across</a>
  <ul class="collapse">
  <li><a href="#r-version-2" id="toc-r-version-2" class="nav-link" data-scroll-target="#r-version-2">R Version</a></li>
  <li><a href="#python-version-2" id="toc-python-version-2" class="nav-link" data-scroll-target="#python-version-2">Python Version</a></li>
  </ul></li>
  <li><a href="#example-4.-conditional-recode" id="toc-example-4.-conditional-recode" class="nav-link" data-scroll-target="#example-4.-conditional-recode">Example 4. Conditional Recode</a>
  <ul class="collapse">
  <li><a href="#r-version-3" id="toc-r-version-3" class="nav-link" data-scroll-target="#r-version-3">R Version</a></li>
  <li><a href="#python-version-3" id="toc-python-version-3" class="nav-link" data-scroll-target="#python-version-3">Python Version</a></li>
  </ul></li>
  <li><a href="#example-5.-pivots" id="toc-example-5.-pivots" class="nav-link" data-scroll-target="#example-5.-pivots">Example 5. Pivots</a>
  <ul class="collapse">
  <li><a href="#r-version-4" id="toc-r-version-4" class="nav-link" data-scroll-target="#r-version-4">R Version</a></li>
  <li><a href="#python-version-4" id="toc-python-version-4" class="nav-link" data-scroll-target="#python-version-4">Python Version</a></li>
  </ul></li>
  <li><a href="#example-6.-joins" id="toc-example-6.-joins" class="nav-link" data-scroll-target="#example-6.-joins">Example 6. Joins</a>
  <ul class="collapse">
  <li><a href="#r-version-5" id="toc-r-version-5" class="nav-link" data-scroll-target="#r-version-5">R Version</a></li>
  <li><a href="#python-version-5" id="toc-python-version-5" class="nav-link" data-scroll-target="#python-version-5">Python Version</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#functional-programming" id="toc-functional-programming" class="nav-link" data-scroll-target="#functional-programming">Functional Programming</a>
  <ul class="collapse">
  <li><a href="#example-7.-function-for-n-pct-by-grouping-variables" id="toc-example-7.-function-for-n-pct-by-grouping-variables" class="nav-link" data-scroll-target="#example-7.-function-for-n-pct-by-grouping-variables">Example 7. Function for n &amp; pct by Grouping Variables</a>
  <ul class="collapse">
  <li><a href="#r-version-6" id="toc-r-version-6" class="nav-link" data-scroll-target="#r-version-6">R Version</a></li>
  <li><a href="#python-version-6" id="toc-python-version-6" class="nav-link" data-scroll-target="#python-version-6">Python Version</a></li>
  </ul></li>
  <li><a href="#example-8.-iterate-a-custom-function" id="toc-example-8.-iterate-a-custom-function" class="nav-link" data-scroll-target="#example-8.-iterate-a-custom-function">Example 8. Iterate a Custom Function</a>
  <ul class="collapse">
  <li><a href="#r-version-7" id="toc-r-version-7" class="nav-link" data-scroll-target="#r-version-7">R Version</a></li>
  <li><a href="#python-version-7" id="toc-python-version-7" class="nav-link" data-scroll-target="#python-version-7">Python Version</a></li>
  </ul></li>
  <li><a href="#example-9.-stack-data-frames-by-list-binding-with-map-and-anonymous-function" id="toc-example-9.-stack-data-frames-by-list-binding-with-map-and-anonymous-function" class="nav-link" data-scroll-target="#example-9.-stack-data-frames-by-list-binding-with-map-and-anonymous-function">Example 9. Stack Data Frames by List Binding with Map and Anonymous Function</a>
  <ul class="collapse">
  <li><a href="#r-version-8" id="toc-r-version-8" class="nav-link" data-scroll-target="#r-version-8">R Version</a></li>
  <li><a href="#python-version-8" id="toc-python-version-8" class="nav-link" data-scroll-target="#python-version-8">Python Version</a></li>
  </ul></li>
  <li><a href="#example-10.-stack-data-frames-by-list-binding-with-pmap-and-anonymous-function-of-dots-..." id="toc-example-10.-stack-data-frames-by-list-binding-with-pmap-and-anonymous-function-of-dots-..." class="nav-link" data-scroll-target="#example-10.-stack-data-frames-by-list-binding-with-pmap-and-anonymous-function-of-dots-...">Example 10. Stack Data Frames by List Binding with pmap and Anonymous Function of Dots (<code>...</code>)</a>
  <ul class="collapse">
  <li><a href="#r-version-9" id="toc-r-version-9" class="nav-link" data-scroll-target="#r-version-9">R Version</a></li>
  <li><a href="#python-version-9" id="toc-python-version-9" class="nav-link" data-scroll-target="#python-version-9">Python Version</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>Before diving into the examples below, it’s important to acknowledge some general differences between R and Python and specific differences in style and approach between Tidy- and Polars-style data manipulation. First and foremost: Python has a strong object orientation while R is essentially a functional language. The practical impact of that difference here is that Python objects are manipulated, or their attributes extracted, by way of methods, while R objects are inputs and outputs of functions. But Python uses functions too, and in fact methods are themselves functions, so this can be very confusing!</p>
<p>What is a method, then? In simple terms, it’s a function defined as part of the blueprint for a given type (or ‘class’) of object. A Polars DataFrame is a class of object, and there are certain functions defined in that class—these are the Polars DataFrame methods. By creating a <em>specific</em> DataFrame, we ‘instantiate’ the class into an object, and we can deploy <a href="https://docs.pola.rs/api/python/dev/reference/dataframe/index.html">a predefined set of methods</a> to do things with or to that object.</p>
<p>In both R and Python we often want to do several operations in a row without distinct assignments for each intermediate step of a process. In R—and especially in the Tidy style of R programming—we can use piping with either the <code>magrittr</code> or base pipes (<code>%&gt;%</code> and <code>|&gt;</code>, respectively) to achieve this. The resulting pipeline starts with an object, passes that object into a function which returns a new object which is passed into another function, and so on and so forth until the desired object is returned by the final function in the pipeline and is captured with an assignment, returned to the console, or passed as input to another pipeline or function. Consider the following example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>cyls<span class="ot">&lt;-</span>mtcars <span class="sc">%&gt;%</span> <span class="co">#1, 5</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cyl) <span class="sc">%&gt;%</span> <span class="co">#2</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cyl) <span class="sc">%&gt;%</span> <span class="co">#3</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="co">#4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we start with the data frame <code>mtcars</code> (1), which is piped as input to the <code>distinct()</code> function along with the column reference <code>cyl</code> (2), which returns a data frame containing only the column <code>cyl</code> and one row for each distinct value. This is piped as input to <code>arrange()</code> (3) along with a column reference to <code>cyl</code>, which returns a sorted data frame. This is piped into <code>pull()</code> (4), which extracts a single column (the only one there: <code>cyl</code>) as a vector. This final object is then assigned to the environment variable <code>cyls</code> (5). Now consider the Python version which utilizes a technique called ‘method chaining’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>cyls<span class="op">=</span>( <span class="co">#5</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    mtcars <span class="co">#1</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    .unique(<span class="st">"cyl"</span>) <span class="co">#2</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"cyl"</span>) <span class="co">#3</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    .get_column(<span class="st">"cyl"</span>) <span class="co">#4</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we start with <code>mtcars</code>, a Polars DataFrame (1). We then apply the <code>unique()</code> method with a reference to the column <code>cyl</code> (2), yielding a Polars DataFrame containing the distinct values of <code>cyl</code> (note that it still contains all the other variables too!). Calling the <code>sort()</code> method sorts the rows by the values of <code>cyl</code> (3). The Polars DataFrame method <code>get_column()</code> (4) extracts a single column and yields a Polars Series (analogous to the atomic vectors that comprise R data frame columns). The resulting Series is assigned to the variable <code>cyls</code> (5).</p>
<p>Both of these code blocks look quite similar, and the Python version should feel familiar to anyone who employs the Tidy-style of programming in R. Now that we’ve seen method chaining in action we can introduce a twist that unlocks some additional efficiency and that may seem strange compared to the Tidy style. The Python block above utilizes what’s called ‘eager evaluation’, which means the code inside <code>cyls=(...)</code> is immediately evaluated and in exactly the manner we have specified. However, Polars is actually implemented in Rust (a high performance systems programming language) and has a query optimization capability that we can exploit via something called ‘lazy evaluation’. The following ‘lazy’ alternative to the previous example gathers our instructions, performs query optimization (yielding a ‘query plan’), and ultimately executes an optimized query only when we invoke the <code>collect()</code> method (a method of Polars LazyFrames which result from invoking the <code>lazy()</code> method of a regular Polars DataFrame).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cyls<span class="op">=</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    mtcars</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    .lazy()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    .unique(<span class="st">"cyl"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"cyl"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    .collect()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    .get_column(<span class="st">"cyl"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that Polars LazyFrames do not have a <code>get_column()</code> method like DataFrames do—it can therefore only be invoked <em>after</em> collection. The advantages of lazy evaluation in this trivial example would not be noticeable but could be significant depending on the size of the data and the complexity of the query. Lazy evaluation also allows for efficient processing of larger-than-memory data frames. See the <a href="https://docs.pola.rs/user-guide/lazy/">User guide</a> for more detail. This approach may seem familiar to anyone who has used the <code>dtplyr</code> R package which allows the user to proved <code>dplyr</code> syntax which is translated into <code>data.table</code> (which is written primarily in C and is much faster than <code>dplyr</code>) under the hood.</p>
<p>Without further ado, let’s dive into some examples.</p>
</section>
<section id="data-manipulation" class="level1">
<h1>Data Manipulation</h1>
<section id="example-1.-basic-summarize-without-generalization-across-variables" class="level2">
<h2 class="anchored" data-anchor-id="example-1.-basic-summarize-without-generalization-across-variables">Example 1. Basic Summarize without Generalization across Variables</h2>
<p>Here, we take on a very simple and very common task: calculating the mean of a continuous variable (<code>mpg</code>) by the levels of a categorical variable (<code>cyl</code>).</p>
<section id="r-version" class="level3">
<h3 class="anchored" data-anchor-id="r-version">R Version</h3>
<p>The Tidy approach utilizes a pipeline comprised of the <code>mtcars</code> data frame and the <code>group_by()</code> and <code>summarize()</code> functions. Note that these functions take a data frame (or tibble) as the first argument, but prevailing style allows this to be passed implicitly (as is done here).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>table<span class="ot">&lt;-</span>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mpg.mean=</span><span class="fu">mean</span>(mpg))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
    cyl mpg.mean
  &lt;dbl&gt;    &lt;dbl&gt;
1     4     26.7
2     6     19.7
3     8     15.1</code></pre>
</div>
</div>
</section>
<section id="python-version" class="level3">
<h3 class="anchored" data-anchor-id="python-version">Python Version</h3>
<p>The Polars approach below begins by reading the R <code>mtcars</code> data frame into the Polars LazyFrame <code>mtcars</code>. The LazyFrame method <code>group_by()</code> is invoked followed by the <code>agg()</code> method. <code>agg()</code> contains an expression that is itself a method chain which yields the mean values for each group as the new variable <code>mpg.mean</code>. <code>table</code> is a Polars DataFrame realized as the result of evaluating an optimized query plan (via <code>collect()</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>mtcars<span class="op">=</span>pl.LazyFrame(r.mtcars)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>q<span class="op">=</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    mtcars</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"cyl"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"mpg"</span>).mean().alias(<span class="st">"mpg.mean"</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>table<span class="op">=</span>q.collect()</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (3, 2)
┌─────┬───────────┐
│ cyl ┆ mpg.mean  │
│ --- ┆ ---       │
│ f64 ┆ f64       │
╞═════╪═══════════╡
│ 4.0 ┆ 26.663636 │
│ 8.0 ┆ 15.1      │
│ 6.0 ┆ 19.742857 │
└─────┴───────────┘</code></pre>
</div>
</div>
</section>
</section>
<section id="example-2.-basic-mutate-with-grouping-and-without-generalization" class="level2">
<h2 class="anchored" data-anchor-id="example-2.-basic-mutate-with-grouping-and-without-generalization">Example 2. Basic Mutate with Grouping and without Generalization</h2>
<p>Here we want to add a new variable to our data frame—the new variable is the ratio of each value of <code>mpg</code> relative to the mean value for the group (defined by the levels of the variable <code>cyl</code>).</p>
<section id="r-version-1" class="level3">
<h3 class="anchored" data-anchor-id="r-version-1">R Version</h3>
<p>In R I can create the new variable with a call to <code>mutate()</code> that utilizes both group-level statistics and record-level data. This can be done in a single step with very little code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>table<span class="ot">&lt;-</span>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rel.mpg=</span>mpg<span class="sc">/</span><span class="fu">mean</span>(mpg))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 12
# Groups:   cyl [3]
     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb rel.mpg
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
 1  21       6  160    110  3.9   2.62  16.5     0     1     4     4   1.06 
 2  21       6  160    110  3.9   2.88  17.0     0     1     4     4   1.06 
 3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1   0.855
 4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1   1.08 
 5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2   1.24 
 6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1   0.917
 7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4   0.947
 8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2   0.915
 9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2   0.855
10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4   0.973
# ℹ 22 more rows</code></pre>
</div>
</div>
</section>
<section id="python-version-1" class="level3">
<h3 class="anchored" data-anchor-id="python-version-1">Python Version</h3>
<p>The Python version uses the <code>with_columns()</code> LazyFrame method. Here, unlike in the R version, the grouping is baked into the recode expression itself by way of <code>over()</code>. Aside from looking a bit different, the Polars approach is more powerful because each expression can utilize its own grouping. Note that the Polars documentation utilizes a ‘contexts’ and ‘expressions’ framework to describe what could also be referred to as methods or method chains. In this example, <code>with_columns()</code> is the context in which the expression yielding the new variable <code>rel.mpg</code> is nested.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>q<span class="op">=</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    mtcars</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"mpg"</span>)<span class="op">/</span>pl.col(<span class="st">"mpg"</span>).mean().over(<span class="st">"cyl"</span>)).alias(<span class="st">"rel.mpg"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>table<span class="op">=</span>q.collect()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (32, 12)
┌──────┬─────┬───────┬───────┬───┬─────┬──────┬──────┬──────────┐
│ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ am  ┆ gear ┆ carb ┆ rel.mpg  │
│ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ --- ┆ ---  ┆ ---  ┆ ---      │
│ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64 ┆ f64  ┆ f64  ┆ f64      │
╞══════╪═════╪═══════╪═══════╪═══╪═════╪══════╪══════╪══════════╡
│ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 1.0 ┆ 4.0  ┆ 4.0  ┆ 1.063676 │
│ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 1.0 ┆ 4.0  ┆ 4.0  ┆ 1.063676 │
│ 22.8 ┆ 4.0 ┆ 108.0 ┆ 93.0  ┆ … ┆ 1.0 ┆ 4.0  ┆ 1.0  ┆ 0.855097 │
│ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ … ┆ 0.0 ┆ 3.0  ┆ 1.0  ┆ 1.083936 │
│ 18.7 ┆ 8.0 ┆ 360.0 ┆ 175.0 ┆ … ┆ 0.0 ┆ 3.0  ┆ 2.0  ┆ 1.238411 │
│ …    ┆ …   ┆ …     ┆ …     ┆ … ┆ …   ┆ …    ┆ …    ┆ …        │
│ 30.4 ┆ 4.0 ┆ 95.1  ┆ 113.0 ┆ … ┆ 1.0 ┆ 5.0  ┆ 2.0  ┆ 1.14013  │
│ 15.8 ┆ 8.0 ┆ 351.0 ┆ 264.0 ┆ … ┆ 1.0 ┆ 5.0  ┆ 4.0  ┆ 1.046358 │
│ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ … ┆ 1.0 ┆ 5.0  ┆ 6.0  ┆ 0.997829 │
│ 15.0 ┆ 8.0 ┆ 301.0 ┆ 335.0 ┆ … ┆ 1.0 ┆ 5.0  ┆ 8.0  ┆ 0.993377 │
│ 21.4 ┆ 4.0 ┆ 121.0 ┆ 109.0 ┆ … ┆ 1.0 ┆ 4.0  ┆ 2.0  ┆ 0.802591 │
└──────┴─────┴───────┴───────┴───┴─────┴──────┴──────┴──────────┘</code></pre>
</div>
</div>
</section>
</section>
<section id="example-3.-summarize-generalized-by-variable-type-with-across" class="level2">
<h2 class="anchored" data-anchor-id="example-3.-summarize-generalized-by-variable-type-with-across">Example 3. Summarize Generalized by Variable Type with Across</h2>
<p>In this example we want to generate means by group (like in example 1), but across a set of columns described by a selection criteria (i.e., not by name).</p>
<section id="r-version-2" class="level3">
<h3 class="anchored" data-anchor-id="r-version-2">R Version</h3>
<p>As before, we specify the grouping via <code>group_by()</code> and generate the means within <code>summarize()</code>. In order to create means for several variables not explicitly specified we can utilize <code>across()</code>. To get means for all variables stored as doubles, we use the helper function <code>where()</code> in the <code>.cols</code> specification. Glue syntax in the <code>.names</code> specification allows us to rename all affected columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cyl,gear) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">.cols=</span><span class="fu">where</span>(is.double)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">.fns=</span>mean</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">.names=</span><span class="st">"{.col}_mean"</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'cyl'. You can override using the `.groups`
argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 11
# Groups:   cyl [3]
    cyl  gear mpg_mean disp_mean hp_mean drat_mean wt_mean qsec_mean vs_mean
  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1     4     3     21.5      120.     97       3.7     2.46      20.0     1  
2     4     4     26.9      103.     76       4.11    2.38      19.6     1  
3     4     5     28.2      108.    102       4.1     1.83      16.8     0.5
4     6     3     19.8      242.    108.      2.92    3.34      19.8     1  
5     6     4     19.8      164.    116.      3.91    3.09      17.7     0.5
6     6     5     19.7      145     175       3.62    2.77      15.5     0  
7     8     3     15.0      358.    194.      3.12    4.10      17.1     0  
8     8     5     15.4      326     300.      3.88    3.37      14.6     0  
# ℹ 2 more variables: am_mean &lt;dbl&gt;, carb_mean &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="python-version-2" class="level3">
<h3 class="anchored" data-anchor-id="python-version-2">Python Version</h3>
<p>The Python version looks very similar to the R version and has the same basic structure as in example 1. Here, though, instead of specifying a column with <code>pl.col()</code> we indicate that we want all columns stored as floats by using <code>cs.float()</code>. Note that there are <em>many</em> selector functions available, as explained <a href="https://docs.pola.rs/api/python/stable/reference/selectors.html">here</a>. The name method <code>name.suffix()</code> is used to rename all affected variables. See other name methods <a href="https://docs.pola.rs/api/python/stable/reference/expressions/name.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>q<span class="op">=</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    mtcars</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"cyl"</span>,<span class="st">"gear"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    .agg(cs.<span class="bu">float</span>().mean().name.suffix(<span class="st">"_mean"</span>))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>table<span class="op">=</span>q.collect()</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (8, 11)
┌─────┬──────┬──────────┬────────────┬───┬───────────┬─────────┬─────────┬───────────┐
│ cyl ┆ gear ┆ mpg_mean ┆ disp_mean  ┆ … ┆ qsec_mean ┆ vs_mean ┆ am_mean ┆ carb_mean │
│ --- ┆ ---  ┆ ---      ┆ ---        ┆   ┆ ---       ┆ ---     ┆ ---     ┆ ---       │
│ f64 ┆ f64  ┆ f64      ┆ f64        ┆   ┆ f64       ┆ f64     ┆ f64     ┆ f64       │
╞═════╪══════╪══════════╪════════════╪═══╪═══════════╪═════════╪═════════╪═══════════╡
│ 4.0 ┆ 3.0  ┆ 21.5     ┆ 120.1      ┆ … ┆ 20.01     ┆ 1.0     ┆ 0.0     ┆ 1.0       │
│ 8.0 ┆ 3.0  ┆ 15.05    ┆ 357.616667 ┆ … ┆ 17.1425   ┆ 0.0     ┆ 0.0     ┆ 3.083333  │
│ 6.0 ┆ 5.0  ┆ 19.7     ┆ 145.0      ┆ … ┆ 15.5      ┆ 0.0     ┆ 1.0     ┆ 6.0       │
│ 6.0 ┆ 3.0  ┆ 19.75    ┆ 241.5      ┆ … ┆ 19.83     ┆ 1.0     ┆ 0.0     ┆ 1.0       │
│ 6.0 ┆ 4.0  ┆ 19.75    ┆ 163.8      ┆ … ┆ 17.67     ┆ 0.5     ┆ 0.5     ┆ 4.0       │
│ 8.0 ┆ 5.0  ┆ 15.4     ┆ 326.0      ┆ … ┆ 14.55     ┆ 0.0     ┆ 1.0     ┆ 6.0       │
│ 4.0 ┆ 4.0  ┆ 26.925   ┆ 102.625    ┆ … ┆ 19.6125   ┆ 1.0     ┆ 0.75    ┆ 1.5       │
│ 4.0 ┆ 5.0  ┆ 28.2     ┆ 107.7      ┆ … ┆ 16.8      ┆ 0.5     ┆ 1.0     ┆ 2.0       │
└─────┴──────┴──────────┴────────────┴───┴───────────┴─────────┴─────────┴───────────┘</code></pre>
</div>
</div>
</section>
</section>
<section id="example-4.-conditional-recode" class="level2">
<h2 class="anchored" data-anchor-id="example-4.-conditional-recode">Example 4. Conditional Recode</h2>
<p>In this example we use if/else if/else logic to create a string recode of the numeric variable <code>mpg</code>.</p>
<section id="r-version-3" class="level3">
<h3 class="anchored" data-anchor-id="r-version-3">R Version</h3>
<p>In the Tidy R approach we deploy <code>case_when()</code> inside of <code>mutate()</code> to create a recode with cascading conditional logic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">mpg.cat=</span><span class="fu">case_when</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>            mpg<span class="sc">&lt;</span><span class="dv">10</span><span class="sc">~</span><span class="st">"very bad"</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            ,mpg<span class="sc">&lt;</span><span class="dv">15</span><span class="sc">~</span><span class="st">"bad"</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            ,mpg<span class="sc">&lt;</span><span class="dv">20</span><span class="sc">~</span><span class="st">"okay"</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            ,mpg<span class="sc">&lt;</span><span class="dv">25</span><span class="sc">~</span><span class="st">"good"</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            ,<span class="cn">TRUE</span><span class="sc">~</span><span class="st">"great"</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(mpg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg cyl  disp  hp drat    wt  qsec vs am gear carb mpg.cat
Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1   great
Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1   great
Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2   great
Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2   great
Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1   great
Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2   great
Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2    good
Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1    good
Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2    good
Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1    good
Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1    good
Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2    good
Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4    good
Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4    good
Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6    okay
Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4    okay
Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2    okay
Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2    okay
Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1    okay
Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4    okay
Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3    okay
Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3    okay
Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4    okay
Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2    okay
Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3    okay
AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2    okay
Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8    okay
Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4     bad
Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4     bad
Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4     bad
Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4     bad
Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4     bad</code></pre>
</div>
</div>
</section>
<section id="python-version-3" class="level3">
<h3 class="anchored" data-anchor-id="python-version-3">Python Version</h3>
<p>The Python version is quite a bit more wordy. Note that <code>pl.lit()</code> is needed here to resolve ambiguity in the way column references can appear as strings in <code>then()</code>—in other words, we’re indicating we want the recoded values to be the provided strings, not the values of columns represented by those strings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>q<span class="op">=</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    mtcars</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        pl.when(pl.col(<span class="st">"mpg"</span>)<span class="op">&lt;</span><span class="dv">10</span>).then(pl.lit(<span class="st">"very bad"</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(<span class="st">"mpg"</span>)<span class="op">&lt;</span><span class="dv">15</span>).then(pl.lit(<span class="st">"bad"</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(<span class="st">"mpg"</span>)<span class="op">&lt;</span><span class="dv">20</span>).then(pl.lit(<span class="st">"okay"</span>))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(<span class="st">"mpg"</span>)<span class="op">&lt;</span><span class="dv">25</span>).then(pl.lit(<span class="st">"good"</span>))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        .otherwise(pl.lit(<span class="st">"great"</span>))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">"mpg.cat"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"mpg"</span>,descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>q.collect()</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (32, 12)
┌──────┬─────┬───────┬───────┬───┬─────┬──────┬──────┬─────────┐
│ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ am  ┆ gear ┆ carb ┆ mpg.cat │
│ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ --- ┆ ---  ┆ ---  ┆ ---     │
│ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64 ┆ f64  ┆ f64  ┆ str     │
╞══════╪═════╪═══════╪═══════╪═══╪═════╪══════╪══════╪═════════╡
│ 33.9 ┆ 4.0 ┆ 71.1  ┆ 65.0  ┆ … ┆ 1.0 ┆ 4.0  ┆ 1.0  ┆ great   │
│ 32.4 ┆ 4.0 ┆ 78.7  ┆ 66.0  ┆ … ┆ 1.0 ┆ 4.0  ┆ 1.0  ┆ great   │
│ 30.4 ┆ 4.0 ┆ 75.7  ┆ 52.0  ┆ … ┆ 1.0 ┆ 4.0  ┆ 2.0  ┆ great   │
│ 30.4 ┆ 4.0 ┆ 95.1  ┆ 113.0 ┆ … ┆ 1.0 ┆ 5.0  ┆ 2.0  ┆ great   │
│ 27.3 ┆ 4.0 ┆ 79.0  ┆ 66.0  ┆ … ┆ 1.0 ┆ 4.0  ┆ 1.0  ┆ great   │
│ …    ┆ …   ┆ …     ┆ …     ┆ … ┆ …   ┆ …    ┆ …    ┆ …       │
│ 14.7 ┆ 8.0 ┆ 440.0 ┆ 230.0 ┆ … ┆ 0.0 ┆ 3.0  ┆ 4.0  ┆ bad     │
│ 14.3 ┆ 8.0 ┆ 360.0 ┆ 245.0 ┆ … ┆ 0.0 ┆ 3.0  ┆ 4.0  ┆ bad     │
│ 13.3 ┆ 8.0 ┆ 350.0 ┆ 245.0 ┆ … ┆ 0.0 ┆ 3.0  ┆ 4.0  ┆ bad     │
│ 10.4 ┆ 8.0 ┆ 472.0 ┆ 205.0 ┆ … ┆ 0.0 ┆ 3.0  ┆ 4.0  ┆ bad     │
│ 10.4 ┆ 8.0 ┆ 460.0 ┆ 215.0 ┆ … ┆ 0.0 ┆ 3.0  ┆ 4.0  ┆ bad     │
└──────┴─────┴───────┴───────┴───┴─────┴──────┴──────┴─────────┘</code></pre>
</div>
</div>
</section>
</section>
<section id="example-5.-pivots" class="level2">
<h2 class="anchored" data-anchor-id="example-5.-pivots">Example 5. Pivots</h2>
<p>In this example we start with <code>mtcars</code> (a version with rownames mapped to the column <code>car</code>), pivot to a long file and then back to wide.</p>
<section id="r-version-4" class="level3">
<h3 class="anchored" data-anchor-id="r-version-4">R Version</h3>
<p>Here we use very simple forms of <code>pivot_longer()</code> and <code>pivot_wider()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>cars<span class="ot">&lt;-</span><span class="fu">rownames_to_column</span>(mtcars,<span class="st">"car"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols=</span><span class="fu">where</span>(is.numeric)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">names_to=</span><span class="st">"variable"</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">values_to=</span><span class="st">"value"</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 352 × 3
   car       variable  value
   &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 Mazda RX4 mpg       21   
 2 Mazda RX4 cyl        6   
 3 Mazda RX4 disp     160   
 4 Mazda RX4 hp       110   
 5 Mazda RX4 drat       3.9 
 6 Mazda RX4 wt         2.62
 7 Mazda RX4 qsec      16.5 
 8 Mazda RX4 vs         0   
 9 Mazda RX4 am         1   
10 Mazda RX4 gear       4   
# ℹ 342 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>mtcars_w_names<span class="ot">&lt;-</span>cars <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols=</span>car</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">names_from=</span><span class="st">"variable"</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">values_from=</span><span class="st">"value"</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mtcars_w_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 12
   car           mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Mazda RX4    21       6  160    110  3.9   2.62  16.5     0     1     4     4
 2 Mazda RX4 …  21       6  160    110  3.9   2.88  17.0     0     1     4     4
 3 Datsun 710   22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
 4 Hornet 4 D…  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
 5 Hornet Spo…  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
 6 Valiant      18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
 7 Duster 360   14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
 8 Merc 240D    24.4     4  147.    62  3.69  3.19  20       1     0     4     2
 9 Merc 230     22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
10 Merc 280     19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
# ℹ 22 more rows</code></pre>
</div>
</div>
</section>
<section id="python-version-4" class="level3">
<h3 class="anchored" data-anchor-id="python-version-4">Python Version</h3>
<p>With polars, going from wide to long is an <a href="https://docs.pola.rs/api/python/dev/reference/dataframe/api/polars.DataFrame.unpivot.html">unpivot</a> and long to wide is a <a href="https://docs.pola.rs/api/python/dev/reference/dataframe/api/polars.DataFrame.pivot.html">pivot</a>. Note that the <code>pivot()</code> is only available in eager mode, as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>q<span class="op">=</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    pl.scan_csv(<span class="st">"mtcars_w_names.csv"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    .unpivot(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span>cs.numeric()</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        ,index<span class="op">=</span><span class="st">"car"</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        ,variable_name<span class="op">=</span><span class="st">"variable"</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        ,value_name<span class="op">=</span><span class="st">"value"</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>cars<span class="op">=</span>q.collect()</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (352, 3)
┌───────────────────┬──────────┬───────┐
│ car               ┆ variable ┆ value │
│ ---               ┆ ---      ┆ ---   │
│ str               ┆ str      ┆ f64   │
╞═══════════════════╪══════════╪═══════╡
│ Mazda RX4         ┆ mpg      ┆ 21.0  │
│ Mazda RX4 Wag     ┆ mpg      ┆ 21.0  │
│ Datsun 710        ┆ mpg      ┆ 22.8  │
│ Hornet 4 Drive    ┆ mpg      ┆ 21.4  │
│ Hornet Sportabout ┆ mpg      ┆ 18.7  │
│ …                 ┆ …        ┆ …     │
│ Lotus Europa      ┆ carb     ┆ 2.0   │
│ Ford Pantera L    ┆ carb     ┆ 4.0   │
│ Ferrari Dino      ┆ carb     ┆ 6.0   │
│ Maserati Bora     ┆ carb     ┆ 8.0   │
│ Volvo 142E        ┆ carb     ┆ 2.0   │
└───────────────────┴──────────┴───────┘</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mtcars_w_names<span class="op">=</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    cars</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    .pivot(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span><span class="st">"car"</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        ,on<span class="op">=</span><span class="st">"variable"</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        ,values<span class="op">=</span><span class="st">"value"</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        ,aggregate_function<span class="op">=</span><span class="va">None</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mtcars_w_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (32, 12)
┌───────────────────┬──────┬─────┬───────┬───┬─────┬─────┬──────┬──────┐
│ car               ┆ mpg  ┆ cyl ┆ disp  ┆ … ┆ vs  ┆ am  ┆ gear ┆ carb │
│ ---               ┆ ---  ┆ --- ┆ ---   ┆   ┆ --- ┆ --- ┆ ---  ┆ ---  │
│ str               ┆ f64  ┆ f64 ┆ f64   ┆   ┆ f64 ┆ f64 ┆ f64  ┆ f64  │
╞═══════════════════╪══════╪═════╪═══════╪═══╪═════╪═════╪══════╪══════╡
│ Mazda RX4         ┆ 21.0 ┆ 6.0 ┆ 160.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │
│ Mazda RX4 Wag     ┆ 21.0 ┆ 6.0 ┆ 160.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │
│ Datsun 710        ┆ 22.8 ┆ 4.0 ┆ 108.0 ┆ … ┆ 1.0 ┆ 1.0 ┆ 4.0  ┆ 1.0  │
│ Hornet 4 Drive    ┆ 21.4 ┆ 6.0 ┆ 258.0 ┆ … ┆ 1.0 ┆ 0.0 ┆ 3.0  ┆ 1.0  │
│ Hornet Sportabout ┆ 18.7 ┆ 8.0 ┆ 360.0 ┆ … ┆ 0.0 ┆ 0.0 ┆ 3.0  ┆ 2.0  │
│ …                 ┆ …    ┆ …   ┆ …     ┆ … ┆ …   ┆ …   ┆ …    ┆ …    │
│ Lotus Europa      ┆ 30.4 ┆ 4.0 ┆ 95.1  ┆ … ┆ 1.0 ┆ 1.0 ┆ 5.0  ┆ 2.0  │
│ Ford Pantera L    ┆ 15.8 ┆ 8.0 ┆ 351.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 4.0  │
│ Ferrari Dino      ┆ 19.7 ┆ 6.0 ┆ 145.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 6.0  │
│ Maserati Bora     ┆ 15.0 ┆ 8.0 ┆ 301.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 8.0  │
│ Volvo 142E        ┆ 21.4 ┆ 4.0 ┆ 121.0 ┆ … ┆ 1.0 ┆ 1.0 ┆ 4.0  ┆ 2.0  │
└───────────────────┴──────┴─────┴───────┴───┴─────┴─────┴──────┴──────┘</code></pre>
</div>
</div>
</section>
</section>
<section id="example-6.-joins" class="level2">
<h2 class="anchored" data-anchor-id="example-6.-joins">Example 6. Joins</h2>
<p>In this example we will show the various join types with two distinct but overlapping subsets of <code>mtcars</code>: cars with 6-cylinder engines and those with horsepower less than 110.</p>
<section id="r-version-5" class="level3">
<h3 class="anchored" data-anchor-id="r-version-5">R Version</h3>
<p>This code is pretty self-explanatory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>carsl<span class="ot">&lt;-</span>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="st">"car"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(cyl<span class="sc">==</span><span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(car,cyl)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>carsr<span class="ot">&lt;-</span>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="st">"car"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(hp<span class="sc">&lt;</span><span class="dv">110</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(car,hp)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(carsl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             car cyl
1      Mazda RX4   6
2  Mazda RX4 Wag   6
3 Hornet 4 Drive   6
4        Valiant   6
5       Merc 280   6
6      Merc 280C   6
7   Ferrari Dino   6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(carsr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              car  hp
1      Datsun 710  93
2         Valiant 105
3       Merc 240D  62
4        Merc 230  95
5        Fiat 128  66
6     Honda Civic  52
7  Toyota Corolla  65
8   Toyota Corona  97
9       Fiat X1-9  66
10  Porsche 914-2  91
11     Volvo 142E 109</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(carsl,carsr,<span class="at">by=</span><span class="st">"car"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             car cyl  hp
1      Mazda RX4   6  NA
2  Mazda RX4 Wag   6  NA
3 Hornet 4 Drive   6  NA
4        Valiant   6 105
5       Merc 280   6  NA
6      Merc 280C   6  NA
7   Ferrari Dino   6  NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">right_join</span>(carsl,carsr,<span class="at">by=</span><span class="st">"car"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              car cyl  hp
1         Valiant   6 105
2      Datsun 710  NA  93
3       Merc 240D  NA  62
4        Merc 230  NA  95
5        Fiat 128  NA  66
6     Honda Civic  NA  52
7  Toyota Corolla  NA  65
8   Toyota Corona  NA  97
9       Fiat X1-9  NA  66
10  Porsche 914-2  NA  91
11     Volvo 142E  NA 109</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(carsl,carsr,<span class="at">by=</span><span class="st">"car"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      car cyl  hp
1 Valiant   6 105</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(carsl,carsr,<span class="at">by=</span><span class="st">"car"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              car cyl  hp
1       Mazda RX4   6  NA
2   Mazda RX4 Wag   6  NA
3  Hornet 4 Drive   6  NA
4         Valiant   6 105
5        Merc 280   6  NA
6       Merc 280C   6  NA
7    Ferrari Dino   6  NA
8      Datsun 710  NA  93
9       Merc 240D  NA  62
10       Merc 230  NA  95
11       Fiat 128  NA  66
12    Honda Civic  NA  52
13 Toyota Corolla  NA  65
14  Toyota Corona  NA  97
15      Fiat X1-9  NA  66
16  Porsche 914-2  NA  91
17     Volvo 142E  NA 109</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(carsl,carsr,<span class="at">by=</span><span class="st">"car"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             car cyl
1      Mazda RX4   6
2  Mazda RX4 Wag   6
3 Hornet 4 Drive   6
4       Merc 280   6
5      Merc 280C   6
6   Ferrari Dino   6</code></pre>
</div>
</div>
</section>
<section id="python-version-5" class="level3">
<h3 class="anchored" data-anchor-id="python-version-5">Python Version</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>carsl<span class="op">=</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    pl.scan_csv(<span class="st">"mtcars_w_names.csv"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"cyl"</span>)<span class="op">==</span><span class="dv">6</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">"car"</span>,<span class="st">"cyl"</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>carsr<span class="op">=</span>(</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    pl.scan_csv(<span class="st">"mtcars_w_names.csv"</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"hp"</span>)<span class="op">&lt;</span><span class="dv">110</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">"car"</span>,<span class="st">"hp"</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(carsl.collect())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (7, 2)
┌────────────────┬─────┐
│ car            ┆ cyl │
│ ---            ┆ --- │
│ str            ┆ i64 │
╞════════════════╪═════╡
│ Mazda RX4      ┆ 6   │
│ Mazda RX4 Wag  ┆ 6   │
│ Hornet 4 Drive ┆ 6   │
│ Valiant        ┆ 6   │
│ Merc 280       ┆ 6   │
│ Merc 280C      ┆ 6   │
│ Ferrari Dino   ┆ 6   │
└────────────────┴─────┘</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(carsr.collect())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (11, 2)
┌────────────────┬─────┐
│ car            ┆ hp  │
│ ---            ┆ --- │
│ str            ┆ i64 │
╞════════════════╪═════╡
│ Datsun 710     ┆ 93  │
│ Valiant        ┆ 105 │
│ Merc 240D      ┆ 62  │
│ Merc 230       ┆ 95  │
│ Fiat 128       ┆ 66  │
│ …              ┆ …   │
│ Toyota Corolla ┆ 65  │
│ Toyota Corona  ┆ 97  │
│ Fiat X1-9      ┆ 66  │
│ Porsche 914-2  ┆ 91  │
│ Volvo 142E     ┆ 109 │
└────────────────┴─────┘</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(carsl.join(carsr,on<span class="op">=</span><span class="st">"car"</span>,how<span class="op">=</span><span class="st">"left"</span>).collect())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (7, 3)
┌────────────────┬─────┬──────┐
│ car            ┆ cyl ┆ hp   │
│ ---            ┆ --- ┆ ---  │
│ str            ┆ i64 ┆ i64  │
╞════════════════╪═════╪══════╡
│ Mazda RX4      ┆ 6   ┆ null │
│ Mazda RX4 Wag  ┆ 6   ┆ null │
│ Hornet 4 Drive ┆ 6   ┆ null │
│ Valiant        ┆ 6   ┆ 105  │
│ Merc 280       ┆ 6   ┆ null │
│ Merc 280C      ┆ 6   ┆ null │
│ Ferrari Dino   ┆ 6   ┆ null │
└────────────────┴─────┴──────┘</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(carsl.join(carsr,on<span class="op">=</span><span class="st">"car"</span>,how<span class="op">=</span><span class="st">"right"</span>).collect())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (11, 3)
┌──────┬────────────────┬─────┐
│ cyl  ┆ car            ┆ hp  │
│ ---  ┆ ---            ┆ --- │
│ i64  ┆ str            ┆ i64 │
╞══════╪════════════════╪═════╡
│ null ┆ Datsun 710     ┆ 93  │
│ 6    ┆ Valiant        ┆ 105 │
│ null ┆ Merc 240D      ┆ 62  │
│ null ┆ Merc 230       ┆ 95  │
│ null ┆ Fiat 128       ┆ 66  │
│ …    ┆ …              ┆ …   │
│ null ┆ Toyota Corolla ┆ 65  │
│ null ┆ Toyota Corona  ┆ 97  │
│ null ┆ Fiat X1-9      ┆ 66  │
│ null ┆ Porsche 914-2  ┆ 91  │
│ null ┆ Volvo 142E     ┆ 109 │
└──────┴────────────────┴─────┘</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(carsl.join(carsr,on<span class="op">=</span><span class="st">"car"</span>,how<span class="op">=</span><span class="st">"inner"</span>).collect())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (1, 3)
┌─────────┬─────┬─────┐
│ car     ┆ cyl ┆ hp  │
│ ---     ┆ --- ┆ --- │
│ str     ┆ i64 ┆ i64 │
╞═════════╪═════╪═════╡
│ Valiant ┆ 6   ┆ 105 │
└─────────┴─────┴─────┘</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(carsl.join(carsr,on<span class="op">=</span><span class="st">"car"</span>,how<span class="op">=</span><span class="st">"full"</span>,coalesce<span class="op">=</span><span class="va">True</span>).collect())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (17, 3)
┌────────────────┬──────┬──────┐
│ car            ┆ cyl  ┆ hp   │
│ ---            ┆ ---  ┆ ---  │
│ str            ┆ i64  ┆ i64  │
╞════════════════╪══════╪══════╡
│ Datsun 710     ┆ null ┆ 93   │
│ Valiant        ┆ 6    ┆ 105  │
│ Merc 240D      ┆ null ┆ 62   │
│ Merc 230       ┆ null ┆ 95   │
│ Fiat 128       ┆ null ┆ 66   │
│ …              ┆ …    ┆ …    │
│ Mazda RX4 Wag  ┆ 6    ┆ null │
│ Ferrari Dino   ┆ 6    ┆ null │
│ Merc 280       ┆ 6    ┆ null │
│ Merc 280C      ┆ 6    ┆ null │
│ Hornet 4 Drive ┆ 6    ┆ null │
└────────────────┴──────┴──────┘</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(carsl.join(carsr,on<span class="op">=</span><span class="st">"car"</span>,how<span class="op">=</span><span class="st">"anti"</span>).collect())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (6, 2)
┌────────────────┬─────┐
│ car            ┆ cyl │
│ ---            ┆ --- │
│ str            ┆ i64 │
╞════════════════╪═════╡
│ Mazda RX4      ┆ 6   │
│ Mazda RX4 Wag  ┆ 6   │
│ Hornet 4 Drive ┆ 6   │
│ Merc 280       ┆ 6   │
│ Merc 280C      ┆ 6   │
│ Ferrari Dino   ┆ 6   │
└────────────────┴─────┘</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="functional-programming" class="level1">
<h1>Functional Programming</h1>
<section id="example-7.-function-for-n-pct-by-grouping-variables" class="level2">
<h2 class="anchored" data-anchor-id="example-7.-function-for-n-pct-by-grouping-variables">Example 7. Function for n &amp; pct by Grouping Variables</h2>
<p>Here we want a custom function to create simple, list-style frequency tables based on one or more variables provided by the user.</p>
<section id="r-version-6" class="level3">
<h3 class="anchored" data-anchor-id="r-version-6">R Version</h3>
<p>We use dynamic dots (<code>...</code>) here to tunnel in the variables provided by the user in the function call. This is powerful and flexible, allowing for 0+ variables provided as naked symbols rather than strings (<code>doit()</code>); an alternative version (<code>doit2()</code>) also uses dynamic dots, but with the intention to call with variable names provided as strings—this scales up better and is more comparable to the python version.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rlang'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:purrr':

    %@%, flatten, flatten_chr, flatten_dbl, flatten_int, flatten_lgl,
    flatten_raw, invoke, splice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>doit<span class="ot">&lt;-</span><span class="cf">function</span>(df,...){</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">N=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(...) <span class="sc">%&gt;%</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),<span class="at">pct=</span><span class="fu">n</span>()<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fu">mean</span>(N),<span class="at">.groups=</span><span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cumn=</span><span class="fu">cumsum</span>(n),<span class="at">cumpct=</span><span class="fu">cumsum</span>(pct))</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="fu">doit</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
      n   pct  cumn cumpct
  &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1    32   100    32    100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doit</span>(mtcars,cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
    cyl     n   pct  cumn cumpct
  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1     4    11  34.4    11   34.4
2     6     7  21.9    18   56.2
3     8    14  43.8    32  100  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doit</span>(mtcars,cyl,gear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 6
    cyl  gear     n   pct  cumn cumpct
  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1     4     3     1  3.12     1   3.12
2     4     4     8 25        9  28.1 
3     4     5     2  6.25    11  34.4 
4     6     3     2  6.25    13  40.6 
5     6     4     4 12.5     17  53.1 
6     6     5     1  3.12    18  56.2 
7     8     3    12 37.5     30  93.8 
8     8     5     2  6.25    32 100   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>doit2<span class="ot">&lt;-</span><span class="cf">function</span>(df,...){</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    vars<span class="ot">&lt;-</span><span class="fu">dots_list</span>(...) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list_c</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">syms</span>()</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">%&gt;%</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">N=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(<span class="sc">!!!</span>vars) <span class="sc">%&gt;%</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),<span class="at">pct=</span><span class="fu">n</span>()<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fu">mean</span>(N),<span class="at">.groups=</span><span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cumn=</span><span class="fu">cumsum</span>(n),<span class="at">cumpct=</span><span class="fu">cumsum</span>(pct))</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="fu">doit2</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
      n   pct  cumn cumpct
  &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1    32   100    32    100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doit2</span>(mtcars,<span class="st">"cyl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
    cyl     n   pct  cumn cumpct
  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1     4    11  34.4    11   34.4
2     6     7  21.9    18   56.2
3     8    14  43.8    32  100  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doit2</span>(mtcars,<span class="st">"cyl"</span>,<span class="st">"gear"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 6
    cyl  gear     n   pct  cumn cumpct
  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1     4     3     1  3.12     1   3.12
2     4     4     8 25        9  28.1 
3     4     5     2  6.25    11  34.4 
4     6     3     2  6.25    13  40.6 
5     6     4     4 12.5     17  53.1 
6     6     5     1  3.12    18  56.2 
7     8     3    12 37.5     30  93.8 
8     8     5     2  6.25    32 100   </code></pre>
</div>
</div>
</section>
<section id="python-version-6" class="level3">
<h3 class="anchored" data-anchor-id="python-version-6">Python Version</h3>
<p>The version below gets very close! The only differences are that the python version of <code>doit()</code> doesn’t work as-is if 0 variables are provided, and the variable names are passed as strings (i.e., this isn’t optional as with the tidy versions). This latter point should actually simplify some situations that are complex due to data mask ambiguities in tidy functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> doit(df,<span class="op">*</span>argv):</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    q<span class="op">=</span>(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>        df</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>        .with_columns(pl.<span class="bu">len</span>().alias(<span class="st">"N"</span>))</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>        .group_by(<span class="op">*</span>argv)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>        .agg(</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>            pl.<span class="bu">len</span>().alias(<span class="st">"n"</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>            ,((pl.<span class="bu">len</span>()<span class="op">*</span><span class="dv">100</span>)<span class="op">/</span>pl.col(<span class="st">"N"</span>).mean()).alias(<span class="st">"pct"</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>        .sort(<span class="op">*</span>argv)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"n"</span>).cum_sum().alias(<span class="st">"cumn"</span>)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>            ,pl.col(<span class="st">"pct"</span>).cum_sum().alias(<span class="st">"cumpct"</span>)</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>    table<span class="op">=</span>q.collect()</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(table)</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>doit(mtcars,<span class="st">"cyl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (3, 5)
┌─────┬─────┬────────┬──────┬────────┐
│ cyl ┆ n   ┆ pct    ┆ cumn ┆ cumpct │
│ --- ┆ --- ┆ ---    ┆ ---  ┆ ---    │
│ f64 ┆ u32 ┆ f64    ┆ u32  ┆ f64    │
╞═════╪═════╪════════╪══════╪════════╡
│ 4.0 ┆ 11  ┆ 34.375 ┆ 11   ┆ 34.375 │
│ 6.0 ┆ 7   ┆ 21.875 ┆ 18   ┆ 56.25  │
│ 8.0 ┆ 14  ┆ 43.75  ┆ 32   ┆ 100.0  │
└─────┴─────┴────────┴──────┴────────┘</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>doit(mtcars,<span class="st">"cyl"</span>,<span class="st">"gear"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (8, 6)
┌─────┬──────┬─────┬───────┬──────┬────────┐
│ cyl ┆ gear ┆ n   ┆ pct   ┆ cumn ┆ cumpct │
│ --- ┆ ---  ┆ --- ┆ ---   ┆ ---  ┆ ---    │
│ f64 ┆ f64  ┆ u32 ┆ f64   ┆ u32  ┆ f64    │
╞═════╪══════╪═════╪═══════╪══════╪════════╡
│ 4.0 ┆ 3.0  ┆ 1   ┆ 3.125 ┆ 1    ┆ 3.125  │
│ 4.0 ┆ 4.0  ┆ 8   ┆ 25.0  ┆ 9    ┆ 28.125 │
│ 4.0 ┆ 5.0  ┆ 2   ┆ 6.25  ┆ 11   ┆ 34.375 │
│ 6.0 ┆ 3.0  ┆ 2   ┆ 6.25  ┆ 13   ┆ 40.625 │
│ 6.0 ┆ 4.0  ┆ 4   ┆ 12.5  ┆ 17   ┆ 53.125 │
│ 6.0 ┆ 5.0  ┆ 1   ┆ 3.125 ┆ 18   ┆ 56.25  │
│ 8.0 ┆ 3.0  ┆ 12  ┆ 37.5  ┆ 30   ┆ 93.75  │
│ 8.0 ┆ 5.0  ┆ 2   ┆ 6.25  ┆ 32   ┆ 100.0  │
└─────┴──────┴─────┴───────┴──────┴────────┘</code></pre>
</div>
</div>
</section>
</section>
<section id="example-8.-iterate-a-custom-function" class="level2">
<h2 class="anchored" data-anchor-id="example-8.-iterate-a-custom-function">Example 8. Iterate a Custom Function</h2>
<p>Here we want to apply the <code>doit</code> functions over parameters.</p>
<section id="r-version-7" class="level3">
<h3 class="anchored" data-anchor-id="r-version-7">R Version</h3>
<p>We can use <code>purrr::pmap()</code> in the R version with a list of parameters. Since we defined the R version of <code>doit</code> to take naked symbols, the mapped version is kind of clunky—a cleaner alternative based on <code>doit2</code> highlights this point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>parms<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(mtcars,mtcars)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    ,<span class="st">"var1"</span><span class="ot">=</span><span class="fu">list</span>(mtcars<span class="sc">$</span>cyl,mtcars<span class="sc">$</span>cyl)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    ,<span class="st">"var2"</span><span class="ot">=</span><span class="fu">list</span>(mtcars<span class="sc">$</span>gear,mtcars<span class="sc">$</span>am)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="fu">pmap</span>(parms,doit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 8 × 6
   var1  var2     n   pct  cumn cumpct
  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1     4     3     1  3.12     1   3.12
2     4     4     8 25        9  28.1 
3     4     5     2  6.25    11  34.4 
4     6     3     2  6.25    13  40.6 
5     6     4     4 12.5     17  53.1 
6     6     5     1  3.12    18  56.2 
7     8     3    12 37.5     30  93.8 
8     8     5     2  6.25    32 100   

[[2]]
# A tibble: 6 × 6
   var1  var2     n   pct  cumn cumpct
  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1     4     0     3  9.38     3   9.38
2     4     1     8 25       11  34.4 
3     6     0     4 12.5     15  46.9 
4     6     1     3  9.38    18  56.2 
5     8     0    12 37.5     30  93.8 
6     8     1     2  6.25    32 100   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>parms2<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(mtcars,mtcars)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    ,<span class="fu">c</span>(<span class="st">"cyl"</span>,<span class="st">"cyl"</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    ,<span class="fu">c</span>(<span class="st">"gear"</span>,<span class="st">"am"</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="fu">pmap</span>(parms2,doit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 8 × 6
    cyl  gear     n   pct  cumn cumpct
  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1     4     3     1  3.12     1   3.12
2     4     4     8 25        9  28.1 
3     4     5     2  6.25    11  34.4 
4     6     3     2  6.25    13  40.6 
5     6     4     4 12.5     17  53.1 
6     6     5     1  3.12    18  56.2 
7     8     3    12 37.5     30  93.8 
8     8     5     2  6.25    32 100   

[[2]]
# A tibble: 6 × 6
    cyl    am     n   pct  cumn cumpct
  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1     4     0     3  9.38     3   9.38
2     4     1     8 25       11  34.4 
3     6     0     4 12.5     15  46.9 
4     6     1     3  9.38    18  56.2 
5     8     0    12 37.5     30  93.8 
6     8     1     2  6.25    32 100   </code></pre>
</div>
</div>
</section>
<section id="python-version-7" class="level3">
<h3 class="anchored" data-anchor-id="python-version-7">Python Version</h3>
<p>Here we combine 3 parameter lists into a single iterator object via <code>zip</code>—we can then map <code>doit</code> over <code>parms</code> via <code>itertools.starmap</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools <span class="im">as</span> it</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>parms<span class="op">=</span><span class="bu">zip</span>(</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    [mtcars,mtcars]</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    ,[<span class="st">'cyl'</span>,<span class="st">'cyl'</span>]</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    ,[<span class="st">'gear'</span>,<span class="st">'am'</span>]</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(it.starmap(doit,parms))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (8, 6)
┌─────┬──────┬─────┬───────┬──────┬────────┐
│ cyl ┆ gear ┆ n   ┆ pct   ┆ cumn ┆ cumpct │
│ --- ┆ ---  ┆ --- ┆ ---   ┆ ---  ┆ ---    │
│ f64 ┆ f64  ┆ u32 ┆ f64   ┆ u32  ┆ f64    │
╞═════╪══════╪═════╪═══════╪══════╪════════╡
│ 4.0 ┆ 3.0  ┆ 1   ┆ 3.125 ┆ 1    ┆ 3.125  │
│ 4.0 ┆ 4.0  ┆ 8   ┆ 25.0  ┆ 9    ┆ 28.125 │
│ 4.0 ┆ 5.0  ┆ 2   ┆ 6.25  ┆ 11   ┆ 34.375 │
│ 6.0 ┆ 3.0  ┆ 2   ┆ 6.25  ┆ 13   ┆ 40.625 │
│ 6.0 ┆ 4.0  ┆ 4   ┆ 12.5  ┆ 17   ┆ 53.125 │
│ 6.0 ┆ 5.0  ┆ 1   ┆ 3.125 ┆ 18   ┆ 56.25  │
│ 8.0 ┆ 3.0  ┆ 12  ┆ 37.5  ┆ 30   ┆ 93.75  │
│ 8.0 ┆ 5.0  ┆ 2   ┆ 6.25  ┆ 32   ┆ 100.0  │
└─────┴──────┴─────┴───────┴──────┴────────┘
shape: (6, 6)
┌─────┬─────┬─────┬───────┬──────┬────────┐
│ cyl ┆ am  ┆ n   ┆ pct   ┆ cumn ┆ cumpct │
│ --- ┆ --- ┆ --- ┆ ---   ┆ ---  ┆ ---    │
│ f64 ┆ f64 ┆ u32 ┆ f64   ┆ u32  ┆ f64    │
╞═════╪═════╪═════╪═══════╪══════╪════════╡
│ 4.0 ┆ 0.0 ┆ 3   ┆ 9.375 ┆ 3    ┆ 9.375  │
│ 4.0 ┆ 1.0 ┆ 8   ┆ 25.0  ┆ 11   ┆ 34.375 │
│ 6.0 ┆ 0.0 ┆ 4   ┆ 12.5  ┆ 15   ┆ 46.875 │
│ 6.0 ┆ 1.0 ┆ 3   ┆ 9.375 ┆ 18   ┆ 56.25  │
│ 8.0 ┆ 0.0 ┆ 12  ┆ 37.5  ┆ 30   ┆ 93.75  │
│ 8.0 ┆ 1.0 ┆ 2   ┆ 6.25  ┆ 32   ┆ 100.0  │
└─────┴─────┴─────┴───────┴──────┴────────┘
[None, None]</code></pre>
</div>
</div>
</section>
</section>
<section id="example-9.-stack-data-frames-by-list-binding-with-map-and-anonymous-function" class="level2">
<h2 class="anchored" data-anchor-id="example-9.-stack-data-frames-by-list-binding-with-map-and-anonymous-function">Example 9. Stack Data Frames by List Binding with Map and Anonymous Function</h2>
<p>What we’re achieving with this example—returning <code>mtcars</code>—isn’t very useful, but it illustrates a common task: mapping an anonymous function over a vector to create a list of data frames which are subsequently stacked together via row binding. In other words, in this example we’re reassembling <code>mtcars</code> by stacking together portions returned from each iteration of <code>map</code>.</p>
<section id="r-version-8" class="level3">
<h3 class="anchored" data-anchor-id="r-version-8">R Version</h3>
<p>Pretty straight forward. Note that parms is a vector here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>parms<span class="ot">&lt;-</span><span class="fu">distinct</span>(mtcars,cyl) <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>list<span class="ot">&lt;-</span><span class="fu">map</span>(</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  parms</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  ,<span class="cf">function</span> (x){</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    mtcars <span class="sc">%&gt;%</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(cyl<span class="sc">==</span>x) <span class="sc">%&gt;%</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(mpg))</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">list_rbind</span>(list)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg cyl  disp  hp drat    wt  qsec vs am gear carb
Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</code></pre>
</div>
</div>
</section>
<section id="python-version-8" class="level3">
<h3 class="anchored" data-anchor-id="python-version-8">Python Version</h3>
<p>This is extremely similar. Note that we’re pulling from the csv of <code>mtcars</code> to utilize eager evaluation (for simplicity).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="op">=</span>pl.read_csv(<span class="st">"mtcars.csv"</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>iterator<span class="op">=</span>mtcars.get_column(<span class="st">"cyl"</span>).unique()</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span><span class="bu">map</span>(</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: (</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>        mtcars</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">filter</span>(pl.col(<span class="st">"cyl"</span>)<span class="op">==</span>x)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>        .sort(<span class="st">"mpg"</span>,descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    ,iterator</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pl.concat(<span class="bu">list</span>(df))</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (32, 11)
┌──────┬─────┬───────┬─────┬───┬─────┬─────┬──────┬──────┐
│ mpg  ┆ cyl ┆ disp  ┆ hp  ┆ … ┆ vs  ┆ am  ┆ gear ┆ carb │
│ ---  ┆ --- ┆ ---   ┆ --- ┆   ┆ --- ┆ --- ┆ ---  ┆ ---  │
│ f64  ┆ i64 ┆ f64   ┆ i64 ┆   ┆ i64 ┆ i64 ┆ i64  ┆ i64  │
╞══════╪═════╪═══════╪═════╪═══╪═════╪═════╪══════╪══════╡
│ 33.9 ┆ 4   ┆ 71.1  ┆ 65  ┆ … ┆ 1   ┆ 1   ┆ 4    ┆ 1    │
│ 32.4 ┆ 4   ┆ 78.7  ┆ 66  ┆ … ┆ 1   ┆ 1   ┆ 4    ┆ 1    │
│ 30.4 ┆ 4   ┆ 75.7  ┆ 52  ┆ … ┆ 1   ┆ 1   ┆ 4    ┆ 2    │
│ 30.4 ┆ 4   ┆ 95.1  ┆ 113 ┆ … ┆ 1   ┆ 1   ┆ 5    ┆ 2    │
│ 27.3 ┆ 4   ┆ 79.0  ┆ 66  ┆ … ┆ 1   ┆ 1   ┆ 4    ┆ 1    │
│ …    ┆ …   ┆ …     ┆ …   ┆ … ┆ …   ┆ …   ┆ …    ┆ …    │
│ 14.7 ┆ 8   ┆ 440.0 ┆ 230 ┆ … ┆ 0   ┆ 0   ┆ 3    ┆ 4    │
│ 14.3 ┆ 8   ┆ 360.0 ┆ 245 ┆ … ┆ 0   ┆ 0   ┆ 3    ┆ 4    │
│ 13.3 ┆ 8   ┆ 350.0 ┆ 245 ┆ … ┆ 0   ┆ 0   ┆ 3    ┆ 4    │
│ 10.4 ┆ 8   ┆ 472.0 ┆ 205 ┆ … ┆ 0   ┆ 0   ┆ 3    ┆ 4    │
│ 10.4 ┆ 8   ┆ 460.0 ┆ 215 ┆ … ┆ 0   ┆ 0   ┆ 3    ┆ 4    │
└──────┴─────┴───────┴─────┴───┴─────┴─────┴──────┴──────┘</code></pre>
</div>
</div>
</section>
</section>
<section id="example-10.-stack-data-frames-by-list-binding-with-pmap-and-anonymous-function-of-dots-..." class="level2">
<h2 class="anchored" data-anchor-id="example-10.-stack-data-frames-by-list-binding-with-pmap-and-anonymous-function-of-dots-...">Example 10. Stack Data Frames by List Binding with pmap and Anonymous Function of Dots (<code>...</code>)</h2>
<p>This example generalizes the previous one to use a data frame with any number of columns (here we’re just using 2) to parameterize the mapping.</p>
<section id="r-version-9" class="level3">
<h3 class="anchored" data-anchor-id="r-version-9">R Version</h3>
<p>Dynamic dots are captured in the list <code>parms</code> within the function and column values are referenced as elements of that list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>parms<span class="ot">&lt;-</span><span class="fu">distinct</span>(mtcars,cyl,gear)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>list<span class="ot">&lt;-</span><span class="fu">pmap</span>(</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  parms</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  ,<span class="cf">function</span> (...){</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    parms<span class="ot">&lt;-</span>rlang<span class="sc">::</span><span class="fu">dots_list</span>(...)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    mtcars <span class="sc">%&gt;%</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(cyl<span class="sc">==</span>parms<span class="sc">$</span>cyl <span class="sc">&amp;</span> gear<span class="sc">==</span>parms<span class="sc">$</span>gear) </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">list_rbind</span>(list)</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg cyl  disp  hp drat    wt  qsec vs am gear carb
Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</code></pre>
</div>
</div>
</section>
<section id="python-version-9" class="level3">
<h3 class="anchored" data-anchor-id="python-version-9">Python Version</h3>
<p>This is very similar to the R version above. The key is that each row of the data frame <code>parms</code> is turned into a dictionary (i.e., has the form <code>{'key1':_key1val_,...,'keyk':_keykval_}</code>). <code>iterator</code> is then a list of dictionaries (<code>iter_rows()</code> returns dictionaries when <code>named=True</code>) which allows us to capture a single row of all parameters needed in the body of the anonymous function with the single parameter <code>dctnry</code>. The parameter values can be referenced by the original <code>parms</code> data frame variable name in the function body via the dictionary method <code>get()</code>. Note that there is a Polars DataFrame method <code>map_rows()</code> that does something similar, but there’s no way to preserve variable names for reference inside the function, so this approach seems preferrable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="op">=</span>pl.read_csv(<span class="st">"mtcars.csv"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>parms<span class="op">=</span>(</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    mtcars</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"cyl"</span>,<span class="st">"gear"</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    .agg()</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>iterator<span class="op">=</span><span class="bu">list</span>(parms.iter_rows(named<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>dfs<span class="op">=</span><span class="bu">map</span>(</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> dctnry: (</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>        mtcars</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">filter</span>(</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"cyl"</span>)<span class="op">==</span>dctnry.get(<span class="st">'cyl'</span>)) <span class="op">&amp;</span> </span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"gear"</span>)<span class="op">==</span>dctnry.get(<span class="st">'gear'</span>))</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    ,iterator</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pl.concat(<span class="bu">list</span>(dfs))</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (32, 11)
┌──────┬─────┬───────┬─────┬───┬─────┬─────┬──────┬──────┐
│ mpg  ┆ cyl ┆ disp  ┆ hp  ┆ … ┆ vs  ┆ am  ┆ gear ┆ carb │
│ ---  ┆ --- ┆ ---   ┆ --- ┆   ┆ --- ┆ --- ┆ ---  ┆ ---  │
│ f64  ┆ i64 ┆ f64   ┆ i64 ┆   ┆ i64 ┆ i64 ┆ i64  ┆ i64  │
╞══════╪═════╪═══════╪═════╪═══╪═════╪═════╪══════╪══════╡
│ 18.7 ┆ 8   ┆ 360.0 ┆ 175 ┆ … ┆ 0   ┆ 0   ┆ 3    ┆ 2    │
│ 14.3 ┆ 8   ┆ 360.0 ┆ 245 ┆ … ┆ 0   ┆ 0   ┆ 3    ┆ 4    │
│ 16.4 ┆ 8   ┆ 275.8 ┆ 180 ┆ … ┆ 0   ┆ 0   ┆ 3    ┆ 3    │
│ 17.3 ┆ 8   ┆ 275.8 ┆ 180 ┆ … ┆ 0   ┆ 0   ┆ 3    ┆ 3    │
│ 15.2 ┆ 8   ┆ 275.8 ┆ 180 ┆ … ┆ 0   ┆ 0   ┆ 3    ┆ 3    │
│ …    ┆ …   ┆ …     ┆ …   ┆ … ┆ …   ┆ …   ┆ …    ┆ …    │
│ 17.8 ┆ 6   ┆ 167.6 ┆ 123 ┆ … ┆ 1   ┆ 0   ┆ 4    ┆ 4    │
│ 26.0 ┆ 4   ┆ 120.3 ┆ 91  ┆ … ┆ 0   ┆ 1   ┆ 5    ┆ 2    │
│ 30.4 ┆ 4   ┆ 95.1  ┆ 113 ┆ … ┆ 1   ┆ 1   ┆ 5    ┆ 2    │
│ 21.5 ┆ 4   ┆ 120.1 ┆ 97  ┆ … ┆ 1   ┆ 0   ┆ 3    ┆ 1    │
│ 19.7 ┆ 6   ┆ 145.0 ┆ 175 ┆ … ┆ 0   ┆ 1   ┆ 5    ┆ 6    │
└──────┴─────┴───────┴─────┴───┴─────┴─────┴──────┴──────┘</code></pre>
</div>
</div>


</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{couzens2025,
  author = {Couzens, Lance},
  title = {Recreating {Some} {Tidy-Style} {R} {Operations} with {Python}
    and {Polars}},
  date = {2025-03-19},
  url = {https://mostlyunoriginal.github.io/posts/2025-03-19-TidyR-to-PolarsPython/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-couzens2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Couzens, Lance. 2025. <span>“Recreating Some Tidy-Style R Operations
with Python and Polars.”</span> March 19, 2025. <a href="https://mostlyunoriginal.github.io/posts/2025-03-19-TidyR-to-PolarsPython/">https://mostlyunoriginal.github.io/posts/2025-03-19-TidyR-to-PolarsPython/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>