{
  "hash": "6bdee45bb716e732c5958e523432fc2d",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"cendat Patch ver 0.4.3\"\ndescription: \"This post covers a recent patch, and light ruminations on the importance of testing.\"\ndate: 2025-08-24\nauthor:\n    - name: Lance Couzens\n      url: https://mostlyunoriginal.github.io  \ncategories: [Python, cendat, Census, API]\ncitation: \n  url: https://mostlyunoriginal.github.io/posts/2025-08-24-cendat-patch/\nimage: Preview.png\ndraft: false\nlightbox: true\n---\n\n# A Neglected Nuance, Addressed\n\nOne of the key features of `cendat` is its ability to automatically build a query list given a target summary level and any parent geography nesting provided by the user via the `within` parameter of the `get_data()` method. This worked as intended, except when the user provided specific geographies *at the target summary level*. In these cases, those specific geographies were ignored and all geographies at that summary level within the parent branch were returned. Patch version 0.4.3 corrects that behavior.\n\nSee below, for example. Under 0.4.2, this request would have returned all places in Colorado and Wyoming, ignoring the specific place requests for Colorado. Now, we correctly get all Wyoming places and only two in Colorado.\n\n::: {#f6faffa3 .cell execution_count=1}\n``` {.python .cell-code}\nimport os\nfrom cendat import CenDatHelper\nimport polars as pl\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\ncdh = CenDatHelper(key=os.getenv(\"CENSUS_API_KEY\"))\n\ncdh.list_products(years=[2022, 2023], patterns=r\"acs/acs5\\)\")\ncdh.set_products()\ncdh.set_variables([\"B01001_001E\", \"YEAR\"])\ncdh.set_geos(\"160\")\nresponse = cdh.get_data(\n    within=[{\"state\": \"08\", \"place\": [\"06255\", \"45970\"]}, {\"state\": \"56\"}]\n)\ndf = (\n    response.to_polars(concat=True, destring=True)\n    .group_by(\"state\", \"vintage\")\n    .agg(n=pl.len())\n)\nprint(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n✅ API key loaded successfully.\n✅ Product set: 'American Community Survey: 5-Year Estimates: Detailed Tables 5-Year (2022/acs/acs5)' (Vintage: [2022])\n✅ Product set: 'ACS 5-Year Detailed Tables (2023/acs/acs5)' (Vintage: [2023])\n✅ Variables set:\n  - Product: American Community Survey: 5-Year Estimates: Detailed Tables 5-Year (2022/acs/acs5) (Vintage: [2022])\n    Variables: B01001_001E\n  - Product: ACS 5-Year Detailed Tables (2023/acs/acs5) (Vintage: [2023])\n    Variables: B01001_001E\n✅ Geographies set: 'place' (requires `within` for: state)\n✅ Parameters created for 2 geo-variable combinations.\nℹ️ Fetching parent geographies for 'place'...\n✅ Found 1 combinations for 'place' within the specified scope.\nℹ️ Fetching parent geographies for 'place'...\n✅ Found 1 combinations for 'place' within the specified scope.\nℹ️ Making 6 API call(s)...\nshape: (4, 3)\n┌───────┬─────────┬─────┐\n│ state ┆ vintage ┆ n   │\n│ ---   ┆ ---     ┆ --- │\n│ str   ┆ i32     ┆ u32 │\n╞═══════╪═════════╪═════╡\n│ 08    ┆ 2023    ┆ 2   │\n│ 08    ┆ 2022    ┆ 2   │\n│ 56    ┆ 2022    ┆ 205 │\n│ 56    ┆ 2023    ┆ 205 │\n└───────┴─────────┴─────┘\n```\n:::\n:::\n\n\n# The Importance of a Robust Test Suite\n\nWhile I have been programming on a near-daily basis for the better part of 20 years, I am not a software developer by trade--I'm a Statistician. This means that much of my coding does not conform to rigid software development protocols. Non-production code for ad hoc data manipulation, analysis, and reporting doesn't rise to the level of 'software' and therefore doesn't require a formal testing protocol (though QC is always important). But, *this is* a codebase that does rise to that level, and I've incorporated many tests to validate the core operations of `cendat` as well its final outputs.\n\nSo, when I *initially* drafted this patch with a very subtle indentation error that only impacted certain scenarios, I was saved by a test suite that covered those scenarios and told me that my change had broken something that worked before. A quick diagnosis and revision, followed by a fresh round of tests that only flashed green let me know I was *actually* ready for a fresh build and new version.\n\nI hope this peek behind the curtain is comforting rather than alarming for users of `cendat`! For me, it was a very gentle but useful reminder that there's a place for run-and-gun and there's a place for strict protocols and it's important to know the difference.\n\n",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}